# 一、XSS 跨站脚本攻击

> Cross Site Scripting 跨站脚本攻击

## 1、基本说明

- 原理
    - 程序+数据=结果，当数据中包含一部分程序的时候，原本的程序逻辑被改变，完成攻击。
    - 简单说明
        - 只运行本站内的东西才安全，如果运行了其他站的东西，就是跨站脚本攻击。
        - 用户写入的内容被当做程序来执行，出现了攻击。
- 分类
    - 反射型：传播带有脚本的 url 给被攻击者
    - 存储型：存储到 DB 中等待被访问时执行

## 2、注入点

- html 节点内容
    - 动态生成的节点，包含用户输入信息，可能执行
- html 属性
    - 动态生成属性，用户输入数据可能突破边界，产生新属性
- js 代码
    - 代码存在变量，包含用户输入数据，可能突破边界，产生新语句
- 富文本
    - 保留 html 代码段

## 3、防御

- 浏览器默认防御
    - X-XSS-Protection:1
    - 防御范围：反射型攻击、只防御 html 内容和属性的插入
- 转义html
    - 节点
        - 转义尖括号，防止解析成 html 标签
        - `str.replace(/</g, '\&lt;'); str.replace(/>/g, '\&gt;'); `
    - 属性
        - 转义引号，防止提前关闭属性并产生新的属性
        - 双引号、单引号，空格隔断， &（最前转义）
        - `str.replace(/"/g, '&quto;');`
- js
    - 转义引号或转成 json
    - 直接转义 \ ，使其失去转义能力
        - `str.replace(/\\/g, '\\\\')`
        - `str.replace(/"/g, '\\"')`
    - 最好直接 JSON.stringify
- 富文本
    - 白名单机制
- CSP 策略
    - `Content Security Policy 内容安全策略`
    - 响应头 Content-Security-Policy
        - eg: frame-ancestors self *.56.com *.baidu.com

# 二、CSRF

> Cross Site Request Forgy 跨站请求伪造

## 1、基本说明

- 原理
    - 请求携带目标网站前端的 Cookies
        - script、image、iframe 的 src 都不受同源策略的影响
        - `跨域携带cookie，不是跨域访问cookie`
    - 攻击网站前端直接向目标网站后端发起请求
    - 表现上，请求的 referer 是攻击网站地址
- 简单说明
    - 其他的网站脚本对本网站产生了影响。其他网站在用户不知情的情况下，对本网站发出了某些请求

## 2、注入点

诱导用户打开攻击页面

## 3、防御

- 限制 cookie 携带
    - 给 cookie 设置 `samesite` 属性
    - 有兼容问题
- 必要访问原网站
    - 必须在原网站执行操作或获取数据，避免静默发送请求
    - 可以用验证码、token
- 验证 referer
    - `/https?:\/\/localhost/.test(referer) `

# 三、Cookie

- 用户权限信息不明文，要加密
    - 不存具体数据，存储 sessionId 鉴权
- XSS 盗取 cookie 
    - 设置 `http-only` 禁止 js 读写
- CSRF 利用 cookie
    - 设置 `samesite`
- sucure
    - 仅 https 可用，防窃听

# 四、其他攻击

## 拒绝服务攻击

- 大量访问冲击
- 要借助第三方服务来动态扩容

## 点击劫持

- 表现
    - 诱导用户点击页面，意外触发 iframe 中的攻击
- 原理
    - 目标网址站被通过 iframe 嵌入
    - 透明 iframe 在上，可能被用户点击
- 防御
    - 禁止内嵌
        - iframe 添加属性 sandbox="allow-form" 禁止脚本、允许表单
    - `X-Frame-Options`
        - 设置 SAMEORIGIN 同源允许

## 密码安全

- 严禁明文存储
- 哈希加盐，防猜解

# 五、HTTPS

- 基本介绍
    - 由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协，要比 http 协议安全
- 数字签名原理
    - 对称加密技术
    - 非对称加密技术
- 加密过程(SSL 原理)
    1. 浏览器内置 CA 名单
    2. 服务器向 CA 申请证书
    3. CA 验证并发证书给服务器
    4. 浏览器请求时，服务器出具证书和公钥
    5. 浏览器验证服务器通过
    6. 浏览器使用公钥生成`随机对称秘钥`发给服务器，包括加密的URL
    7. 服务器使用私钥解密对称秘钥，然后用对称秘钥进行加密传输

# 六、项目中处理安全问题